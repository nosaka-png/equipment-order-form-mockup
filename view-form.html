<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>閲覧用シート＆フォーム（アズロジ側）</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    /* 閲覧用シート固有のスタイル */
    .step-indicator {
      display: flex;
      gap: 0;
      margin-bottom: 24px;
      overflow-x: auto;
    }
    .step-indicator__item {
      flex: 1;
      text-align: center;
      padding: 10px 8px;
      font-size: 0.8rem;
      font-weight: 600;
      background: #f0f0f0;
      color: #999;
      border-right: 2px solid #fff;
      position: relative;
    }
    .step-indicator__item:last-child {
      border-right: none;
    }
    .step-indicator__item.is-active {
      background: #1976d2;
      color: #fff;
    }
    .step-indicator__item.is-done {
      background: #e8f5e9;
      color: #2e7d32;
    }

    .shortage-item-row {
      display: flex;
      gap: 12px;
      align-items: center;
      margin-bottom: 8px;
      padding: 8px;
      background: #fff;
      border: 1px solid #e0e0e0;
      border-radius: 4px;
    }
    .shortage-item-row .item-name {
      flex: 2;
      font-weight: 600;
      font-size: 0.9rem;
    }
    .shortage-item-row .shortage-qty {
      flex: 1;
    }
    .shortage-item-row .shortage-note {
      flex: 3;
    }
    .shortage-item-row input,
    .shortage-item-row textarea {
      width: 100%;
      padding: 6px 8px;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 0.85rem;
      font-family: inherit;
    }
    .shortage-item-row textarea {
      min-height: 36px;
      resize: vertical;
    }

    .response-section {
      display: none;
      margin-top: 16px;
      padding: 16px;
      background: #f3e5f5;
      border: 1px solid #ce93d8;
      border-radius: 4px;
    }
    .response-section.is-visible {
      display: block;
    }
  </style>
</head>
<body>

  <!-- ヘッダー -->
  <header class="header">
    <h1 class="header__title">閲覧用シート＆フォーム</h1>
    <span class="header__role header__role--azlogi">アズロジ側</span>
  </header>

  <div style="padding:0 24px; display:flex; gap:20px;">
    <a href="index.html" class="nav-link" style="margin:16px 0 0;">&#8592; Dir側「ALLDATA_備品発注フォーム」</a>
    <a href="mentor-check.html" class="nav-link" style="margin:16px 0 0;">&#8594; メンター用「備品チェック画面」</a>
  </div>

  <main class="main">

    <!-- ステップインジケーター -->
    <div class="step-indicator" id="stepIndicator">
      <div class="step-indicator__item is-active" data-step="1">1. 発注内容確認</div>
      <div class="step-indicator__item" data-step="2">2. 欠品チェック</div>
      <div class="step-indicator__item" data-step="3">3. Dir対応待ち</div>
      <div class="step-indicator__item" data-step="4">4. 対応内容確認</div>
      <div class="step-indicator__item" data-step="5">5. 発送報告</div>
      <div class="step-indicator__item" data-step="6">6. 完了</div>
    </div>

    <!-- セクション1: 発注内容の閲覧（読み取り専用） -->
    <div class="section">
      <div class="section__header">発注内容（Dir側からの依頼） <span class="badge badge--pending">確認待ち</span></div>
      <div class="section__body">
        <table class="readonly-table">
          <tr>
            <th>発注元</th>
            <td>山田 太郎（営業部）</td>
          </tr>
          <tr>
            <th>研修ID</th>
            <td>00001_トヨタDX2Days 2/12-13 [DX]</td>
          </tr>
          <tr>
            <th>宛先</th>
            <td>愛知県豊田市トヨタ町1番地 研修棟 2F</td>
          </tr>
          <tr>
            <th>到着希望日時</th>
            <td>2026年2月11日 10:00</td>
          </tr>
          <tr>
            <th>発注日</th>
            <td>2026年2月8日</td>
          </tr>
          <tr>
            <th>人数 / チーム数</th>
            <td>20名 / 5チーム</td>
          </tr>
          <tr>
            <th>備考</th>
            <td>前日搬入希望。駐車場は研修棟裏手をご利用ください。</td>
          </tr>
        </table>

        <h4 style="margin:16px 0 8px; font-size:0.9rem; color:#555;">発注品目一覧</h4>
        <div class="table-wrap">
          <table class="data-table" id="orderItemsTable">
            <thead>
              <tr>
                <th>#</th>
                <th>品目名</th>
                <th>カテゴリ</th>
                <th style="text-align:right;">発注数量</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>1</td>
                <td>ノートPC</td>
                <td>PC機器</td>
                <td style="text-align:right;">20</td>
              </tr>
              <tr>
                <td>2</td>
                <td>マウス</td>
                <td>PC周辺機器</td>
                <td style="text-align:right;">20</td>
              </tr>
              <tr>
                <td>3</td>
                <td>HDMIケーブル</td>
                <td>ケーブル</td>
                <td style="text-align:right;">5</td>
              </tr>
              <tr>
                <td>4</td>
                <td>モニター（24インチ）</td>
                <td>PC周辺機器</td>
                <td style="text-align:right;">5</td>
              </tr>
              <tr>
                <td>5</td>
                <td>ホワイトボードマーカーセット</td>
                <td>文具</td>
                <td style="text-align:right;">5</td>
              </tr>
              <tr>
                <td>6</td>
                <td>付箋（大）</td>
                <td>文具</td>
                <td style="text-align:right;">20</td>
              </tr>
              <tr>
                <td>7</td>
                <td>電源タップ（6口）</td>
                <td>電源</td>
                <td style="text-align:right;">5</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- セクション2: 欠品確認 -->
    <div class="section">
      <div class="section__header">欠品確認</div>
      <div class="section__body">
        <div class="form-group">
          <label class="form-label">上記の発注品目に欠品はありますか？ <span class="required">※必須</span></label>
          <div class="radio-group">
            <label>
              <input type="radio" name="shortage" value="no" id="shortageNo"> なし（全品対応可能）
            </label>
            <label>
              <input type="radio" name="shortage" value="yes" id="shortageYes"> あり（一部欠品あり）
            </label>
          </div>
        </div>

        <!-- 欠品ありの場合のみ表示 -->
        <div class="conditional-section" id="shortageSection">
          <h4 style="margin-bottom:12px; font-size:0.9rem; color:#c62828;">欠品内容を入力してください</h4>
          <div style="margin-bottom:8px; display:flex; gap:12px; font-size:0.78rem; color:#777; padding:0 8px;">
            <span style="flex:2;">品目名</span>
            <span style="flex:1;">欠品数</span>
            <span style="flex:3;">備考</span>
          </div>
          <div id="shortageItems">
            <div class="shortage-item-row">
              <span class="item-name">ノートPC</span>
              <div class="shortage-qty"><input type="number" min="0" value="0" placeholder="欠品数"></div>
              <div class="shortage-note"><input type="text" placeholder="備考（入荷予定等）"></div>
            </div>
            <div class="shortage-item-row">
              <span class="item-name">マウス</span>
              <div class="shortage-qty"><input type="number" min="0" value="0" placeholder="欠品数"></div>
              <div class="shortage-note"><input type="text" placeholder="備考（入荷予定等）"></div>
            </div>
            <div class="shortage-item-row">
              <span class="item-name">HDMIケーブル</span>
              <div class="shortage-qty"><input type="number" min="0" value="0" placeholder="欠品数"></div>
              <div class="shortage-note"><input type="text" placeholder="備考（入荷予定等）"></div>
            </div>
            <div class="shortage-item-row">
              <span class="item-name">モニター（24インチ）</span>
              <div class="shortage-qty"><input type="number" min="0" value="0" placeholder="欠品数"></div>
              <div class="shortage-note"><input type="text" placeholder="備考（入荷予定等）"></div>
            </div>
            <div class="shortage-item-row">
              <span class="item-name">ホワイトボードマーカーセット</span>
              <div class="shortage-qty"><input type="number" min="0" value="0" placeholder="欠品数"></div>
              <div class="shortage-note"><input type="text" placeholder="備考（入荷予定等）"></div>
            </div>
            <div class="shortage-item-row">
              <span class="item-name">付箋（大）</span>
              <div class="shortage-qty"><input type="number" min="0" value="0" placeholder="欠品数"></div>
              <div class="shortage-note"><input type="text" placeholder="備考（入荷予定等）"></div>
            </div>
            <div class="shortage-item-row">
              <span class="item-name">電源タップ（6口）</span>
              <div class="shortage-qty"><input type="number" min="0" value="0" placeholder="欠品数"></div>
              <div class="shortage-note"><input type="text" placeholder="備考（入荷予定等）"></div>
            </div>
          </div>

          <div class="btn-group" style="margin-top:16px;">
            <button type="button" class="btn btn--warning" id="btnReportShortage">欠品内容を報告（Slack通知）</button>
          </div>
        </div>

        <!-- 欠品報告後のアラート -->
        <div class="alert alert--info" id="shortageAlert">
          欠品内容をSlackで通知しました。このフォームのURLがDir側へ共有されます。
        </div>
      </div>
    </div>

    <!-- セクション3: Dir対応待ち -->
    <div class="section" id="waitingSection" style="display:none;">
      <div class="section__header">Dir側の対応待ち <span class="badge badge--pending">対応待ち</span></div>
      <div class="section__body">
        <p style="font-size:0.9rem; color:#777; line-height:1.8;">
          欠品内容がDir側へ通知されました。<br>
          Dir側が各欠品品目に対して対応方針を記入するまでお待ちください。<br>
          対応内容が記入されると、Slackで通知されます。
        </p>
        <div class="btn-group">
          <button type="button" class="btn btn--primary" id="btnSimulateDir" style="opacity:0.85;">（モック）Dir側の対応入力をシミュレート</button>
        </div>
      </div>
    </div>

    <!-- セクション4: Dir側の対応内容確認（アズロジ読み取り専用） -->
    <div class="section" id="responseSection" style="display:none;">
      <div class="section__header">不足備品の対応内容（Dir側が記入済み） <span class="badge badge--done">Dir記入済み</span></div>
      <div class="section__body">
        <p style="font-size:0.85rem; color:#555; margin-bottom:12px;">
          Dir側が各欠品品目に対して以下の対応を記入しました。内容を確認のうえ、発送準備を進めてください。
        </p>

        <div class="table-wrap">
          <table class="data-table" id="dirResponseTable">
            <thead>
              <tr>
                <th>品目名</th>
                <th style="text-align:right;">欠品数</th>
                <th>Dir対応方針</th>
                <th>Dir対応詳細</th>
              </tr>
            </thead>
            <tbody id="dirResponseBody">
              <!-- JSで動的に生成 -->
            </tbody>
          </table>
        </div>

        <div class="btn-group" style="margin-top:16px;">
          <button type="button" class="btn btn--success" id="btnConfirmResponse">対応内容を確認しました — 発送準備に進む</button>
        </div>

        <div class="alert alert--success" id="responseAlert">
          対応内容を確認しました。発送報告に進んでください。
        </div>
      </div>
    </div>

    <!-- セクション4: 発送報告 -->
    <div class="section">
      <div class="section__header">発送報告</div>
      <div class="section__body">
        <div class="form-inline">
          <div class="form-group">
            <label class="form-label">発送日 <span class="required">※必須</span></label>
            <input type="date" class="form-input" id="shipDate">
          </div>
        </div>
        <div class="form-group" style="margin-top:12px;">
          <label class="form-label">伝票PDF添付 <span class="required">※必須</span></label>
          <p style="font-size:0.8rem; color:#777; margin-bottom:6px;">ヤマト運輸の伝票PDFをアップロードしてください（複数可）</p>
          <input type="file" id="slipFiles" multiple accept=".pdf,.jpg,.jpeg,.png" style="font-size:0.9rem;">
          <div id="fileList" style="margin-top:8px;"></div>
        </div>
        <div class="form-group">
          <label class="form-label">発送に関する備考</label>
          <textarea class="form-textarea" placeholder="梱包数、到着予定日など" id="shipRemarks" style="min-height:60px;"></textarea>
        </div>
        <div class="btn-group">
          <button type="button" class="btn btn--success" id="btnShip">発送完了を報告</button>
        </div>

        <div class="alert alert--success" id="shipAlert">
          発送完了を報告しました。Dir側へ自動通知されます。
        </div>
      </div>
    </div>

  </main>

  <!-- 完了モーダル -->
  <div class="modal-overlay" id="completeModal">
    <div class="modal">
      <div class="modal__title">発送完了</div>
      <div class="modal__message">
        発送報告が完了しました。<br>
        Dir側へSlackで自動通知されます。<br><br>
        <strong>配送業者:</strong> ヤマト運輸（固定）<br>
        <strong>発送日:</strong> <span id="completedDate"></span><br>
        <strong>添付ファイル:</strong> <span id="completedFiles"></span>
      </div>
      <div class="modal__actions">
        <button class="btn btn--primary" id="btnCompleteOk">OK</button>
      </div>
    </div>
  </div>

  <footer class="footer">
    備品発注フォーム モックアップ &copy; 2026
  </footer>

  <script>
    (function () {
      // --- 要素取得 ---
      var shortageYes = document.getElementById('shortageYes');
      var shortageNo = document.getElementById('shortageNo');
      var shortageSection = document.getElementById('shortageSection');
      var waitingSection = document.getElementById('waitingSection');
      var responseSection = document.getElementById('responseSection');
      var btnReportShortage = document.getElementById('btnReportShortage');
      var shortageAlert = document.getElementById('shortageAlert');
      var btnSimulateDir = document.getElementById('btnSimulateDir');
      var btnConfirmResponse = document.getElementById('btnConfirmResponse');
      var responseAlert = document.getElementById('responseAlert');
      var btnShip = document.getElementById('btnShip');
      var shipAlert = document.getElementById('shipAlert');
      var completeModal = document.getElementById('completeModal');
      var btnCompleteOk = document.getElementById('btnCompleteOk');
      var stepItems = document.querySelectorAll('.step-indicator__item');
      var dirResponseBody = document.getElementById('dirResponseBody');

      // --- Dir側のダミー対応データ ---
      var dirResponseData = {
        'ノートPC':                 { policy: '代替品手配',   detail: 'Lenovo ThinkPad E14を代替として手配済み。2/10入荷予定。' },
        'マウス':                   { policy: '在庫分のみ先行発送', detail: '在庫15個を先行発送。残5個は2/12入荷後に追送。' },
        'HDMIケーブル':             { policy: '対応不要',     detail: '在庫十分のため欠品なしとして処理。' },
        'モニター（24インチ）':     { policy: '入荷待ち',     detail: 'Dell P2422H 5台を発注済み。2/10着予定。研修には間に合う見込み。' },
        'ホワイトボードマーカーセット': { policy: '対応不要', detail: '在庫確認済み。問題なし。' },
        '付箋（大）':               { policy: '代替品手配',   detail: '3M製からコクヨ製に変更して手配。同等品質。' },
        '電源タップ（6口）':        { policy: '対応不要',     detail: '在庫確認済み。問題なし。' }
      };

      // --- ステップ更新（6ステップ対応） ---
      function setStep(activeStep) {
        stepItems.forEach(function (el) {
          var step = parseInt(el.getAttribute('data-step'));
          el.classList.remove('is-active', 'is-done');
          if (step < activeStep) {
            el.classList.add('is-done');
          } else if (step === activeStep) {
            el.classList.add('is-active');
          }
        });
      }

      // --- 欠品あり/なし切替 ---
      shortageYes.addEventListener('change', function () {
        shortageSection.classList.add('is-visible');
        waitingSection.style.display = 'none';
        responseSection.style.display = 'none';
        shortageAlert.classList.remove('is-visible');
        responseAlert.classList.remove('is-visible');
        setStep(2);
      });

      shortageNo.addEventListener('change', function () {
        shortageSection.classList.remove('is-visible');
        waitingSection.style.display = 'none';
        responseSection.style.display = 'none';
        shortageAlert.classList.remove('is-visible');
        responseAlert.classList.remove('is-visible');
        setStep(5);
      });

      // --- 欠品報告ボタン → Dir側へ通知 & 対応待ちセクション表示 ---
      btnReportShortage.addEventListener('click', function () {
        shortageAlert.classList.add('is-visible');
        waitingSection.style.display = 'block';
        responseSection.style.display = 'none';
        setStep(3);
      });

      // --- （モック）Dir側の対応入力をシミュレート ---
      btnSimulateDir.addEventListener('click', function () {
        // 欠品として入力された品目のデータを収集
        var shortageRows = document.querySelectorAll('#shortageItems .shortage-item-row');
        var html = '';
        shortageRows.forEach(function (row) {
          var name = row.querySelector('.item-name').textContent;
          var qty = parseInt(row.querySelector('.shortage-qty input').value) || 0;
          if (qty > 0) {
            var resp = dirResponseData[name] || { policy: '検討中', detail: '対応を検討中です。' };
            html += '<tr>';
            html += '<td style="font-weight:600;">' + name + '</td>';
            html += '<td style="text-align:right;">' + qty + '</td>';
            html += '<td><span class="badge badge--done">' + resp.policy + '</span></td>';
            html += '<td style="font-size:0.85rem;">' + resp.detail + '</td>';
            html += '</tr>';
          }
        });

        if (html === '') {
          // 欠品数が入力されていなかった場合、全品目をダミー表示
          shortageRows.forEach(function (row) {
            var name = row.querySelector('.item-name').textContent;
            var resp = dirResponseData[name] || { policy: '検討中', detail: '対応を検討中です。' };
            html += '<tr>';
            html += '<td style="font-weight:600;">' + name + '</td>';
            html += '<td style="text-align:right;">-</td>';
            html += '<td><span class="badge badge--done">' + resp.policy + '</span></td>';
            html += '<td style="font-size:0.85rem;">' + resp.detail + '</td>';
            html += '</tr>';
          });
        }

        dirResponseBody.innerHTML = html;
        waitingSection.style.display = 'none';
        responseSection.style.display = 'block';
        setStep(4);
      });

      // --- 対応内容確認 → 発送報告へ ---
      btnConfirmResponse.addEventListener('click', function () {
        responseAlert.classList.add('is-visible');
        setStep(5);
      });

      // --- ファイル選択時のプレビュー ---
      var slipFiles = document.getElementById('slipFiles');
      var fileList = document.getElementById('fileList');
      slipFiles.addEventListener('change', function () {
        fileList.innerHTML = '';
        if (this.files.length > 0) {
          var ul = document.createElement('ul');
          ul.style.cssText = 'list-style:none; padding:0; margin:0;';
          for (var i = 0; i < this.files.length; i++) {
            var li = document.createElement('li');
            li.style.cssText = 'font-size:0.85rem; color:#555; padding:2px 0;';
            li.textContent = '\uD83D\uDCCE ' + this.files[i].name + '\uFF08' + (this.files[i].size / 1024).toFixed(1) + ' KB\uFF09';
            ul.appendChild(li);
          }
          fileList.appendChild(ul);
        }
      });

      // --- 発送完了報告 ---
      btnShip.addEventListener('click', function () {
        var shipDate = document.getElementById('shipDate').value;
        var files = slipFiles.files;

        if (!shipDate) {
          alert('発送日は必須です。');
          return;
        }
        if (files.length === 0) {
          alert('伝票PDFを1つ以上添付してください。');
          return;
        }

        // 完了モーダル表示
        var fileNames = [];
        for (var i = 0; i < files.length; i++) {
          fileNames.push(files[i].name);
        }
        document.getElementById('completedDate').textContent = shipDate;
        document.getElementById('completedFiles').textContent = fileNames.join(', ');
        completeModal.classList.add('is-visible');

        shipAlert.classList.add('is-visible');
        setStep(6);
      });

      // --- 完了モーダルを閉じる ---
      btnCompleteOk.addEventListener('click', function () {
        completeModal.classList.remove('is-visible');
      });

      completeModal.addEventListener('click', function (e) {
        if (e.target === completeModal) {
          completeModal.classList.remove('is-visible');
        }
      });

      // --- 初期値：発送日を今日にする ---
      var today = new Date();
      var yyyy = today.getFullYear();
      var mm = String(today.getMonth() + 1).padStart(2, '0');
      var dd = String(today.getDate()).padStart(2, '0');
      document.getElementById('shipDate').value = yyyy + '-' + mm + '-' + dd;

    })();
  </script>

</body>
</html>
